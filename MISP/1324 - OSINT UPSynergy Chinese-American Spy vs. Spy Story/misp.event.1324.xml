<?xml version="1.0" encoding="UTF-8"?>
<response><Event><id>1324</id><orgc_id>1</orgc_id><org_id>1</org_id><date>2019-09-17</date><threat_level_id>1</threat_level_id><info>OSINT: UPSynergy: Chinese-American Spy vs. Spy Story</info><published>1</published><uuid>5d810f7f-a56c-49fb-9108-72b80a000082</uuid><analysis>2</analysis><timestamp>1568739858</timestamp><distribution>3</distribution><publish_timestamp>1568739866</publish_timestamp><sharing_group_id>0</sharing_group_id><disable_correlation>0</disable_correlation><extends_uuid/><Org><id>1</id><name>Profero</name><uuid>5d757a38-e86c-47dc-ae94-6fb81c6c3325</uuid><local>1</local></Org><Orgc><id>1</id><name>Profero</name><uuid>5d757a38-e86c-47dc-ae94-6fb81c6c3325</uuid><local>1</local></Orgc><Attribute><id>1614678</id><type>comment</type><category>External analysis</category><to_ids>0</to_ids><uuid>5d810ff5-4514-45ca-8baa-7c310a000082</uuid><event_id>1324</event_id><distribution>5</distribution><timestamp>1568739317</timestamp><comment/><sharing_group_id>0</sharing_group_id><deleted>0</deleted><disable_correlation>0</disable_correlation><object_id>0</object_id><object_relation/><value>The group’s exploitation tool named Bemstour makes use of a variant of a single Equation group exploit. Our research shows that the particular equivalent to this exploit is EternalRomance. APT3 developed their own implementation, possibly based on their analysis and understanding of EternalRomance’s leveraged vulnerability.
The group attempted to develop the exploit in a way that allowed it to target more Windows versions, similar to what was done in a parallel Equation group exploit named EternalSynergy. This required looking for an additional 0-day that provided them with a kernel information leak. All of this activity suggests that the group was not exposed to an actual NSA exploitation tool, as they would then not need to create another 0-day exploit. We decided to name APT3’s bundle of exploits UPSynergy, since, much like in the case of Equation group, it combines 2 different exploits to expand the support to newer operating systems.
The underlying SMB packets used throughout the tool execution were crafted manually by the developers, rather than generated using a third party library. As a lot of these packets were assigned with hardcoded and seemingly arbitrary data, as well as the existence of other unique hardcoded SMB artifacts, we can assume that the developers were trying to recreate the exploit based on previously recorded traffic.
If network traffic was indeed used by the group as a reference, the traffic was likely collected from a machine controlled by APT3. This means either a Chinese machine that was targeted by the NSA and monitored by the group, or a machine compromised by the group beforehand on which foreign activity was noticed. We believe the former is more likely, and in that case could be made possible by capturing lateral movement within a victim network targeted by the Equation group.
Finding a 0-day info leak, recreating the exploit based on the aforementioned vulnerability, and utilizing a lot of internal undocumented structures of SMB in the implants, implies that there was a similar expertise with and analysis performed on SMB drivers (with an eye to exploiting them) on the Chinese side, roughly at the same time it was widely used by the NSA. This, to some extent, suggests a narrative where China and the US are engaged in a cyber arms race to develop new exploits.</value><Galaxy/><ShadowAttribute/></Attribute><Attribute><id>1614679</id><type>link</type><category>External analysis</category><to_ids>0</to_ids><uuid>5d811004-1f68-42fb-a2e3-7c310a000082</uuid><event_id>1324</event_id><distribution>5</distribution><timestamp>1568739332</timestamp><comment/><sharing_group_id>0</sharing_group_id><deleted>0</deleted><disable_correlation>0</disable_correlation><object_id>0</object_id><object_relation/><value>https://research.checkpoint.com/upsynergy/</value><Galaxy/><ShadowAttribute/></Attribute><Attribute><id>1614680</id><type>md5</type><category>Payload delivery</category><to_ids>1</to_ids><uuid>5d8110df-6840-498e-9a88-7c330a000082</uuid><event_id>1324</event_id><distribution>5</distribution><timestamp>1568739551</timestamp><comment/><sharing_group_id>0</sharing_group_id><deleted>0</deleted><disable_correlation>0</disable_correlation><object_id>0</object_id><object_relation/><value>f595228976cc89ffac02d831e774cfa6</value><Galaxy/><ShadowAttribute/></Attribute><Attribute><id>1614681</id><type>sha1</type><category>Payload delivery</category><to_ids>1</to_ids><uuid>5d8110ec-af38-463b-b305-7c330a000082</uuid><event_id>1324</event_id><distribution>5</distribution><timestamp>1568739564</timestamp><comment/><sharing_group_id>0</sharing_group_id><deleted>0</deleted><disable_correlation>0</disable_correlation><object_id>0</object_id><object_relation/><value>80143e32f887b2583b777daec5982fb5c2886fb3</value><Galaxy/><ShadowAttribute/></Attribute><Attribute><id>1614682</id><type>sha256</type><category>Payload delivery</category><to_ids>1</to_ids><uuid>5d8110f5-7894-44be-b81e-72b40a000082</uuid><event_id>1324</event_id><distribution>5</distribution><timestamp>1568739580</timestamp><comment/><sharing_group_id>0</sharing_group_id><deleted>0</deleted><disable_correlation>0</disable_correlation><object_id>0</object_id><object_relation/><value>0b28433a2b7993da65e95a45c2adf7bc37edbd2a8db717b85666d6c88140698a</value><Galaxy/><ShadowAttribute/></Attribute><Object/><ShadowAttribute/><RelatedEvent/><Tag><id>936</id><name>misp-galaxy:mitre-enterprise-attack-intrusion-set=&quot;APT3 - G0022&quot;</name><colour>#0088cc</colour><exportable>1</exportable><user_id>0</user_id><hide_tag>0</hide_tag><numerical_value/></Tag><Tag><id>250</id><name>misp-galaxy:threat-actor=&quot;UPS&quot;</name><colour>#0fbe00</colour><exportable>1</exportable><user_id>0</user_id><hide_tag>0</hide_tag><numerical_value/></Tag><Tag><id>937</id><name>misp-galaxy:mitre-attack-pattern=&quot;Exploitation of Remote Services - T1210&quot;</name><colour>#0088cc</colour><exportable>1</exportable><user_id>0</user_id><hide_tag>0</hide_tag><numerical_value/></Tag><Tag><id>938</id><name>misp-galaxy:mitre-attack-pattern=&quot;Exploitation for Privilege Escalation - T1068&quot;</name><colour>#0088cc</colour><exportable>1</exportable><user_id>0</user_id><hide_tag>0</hide_tag><numerical_value/></Tag><Tag><id>8</id><name>osint:source-type=&quot;blog-post&quot;</name><colour>#00223b</colour><exportable>1</exportable><user_id>0</user_id><hide_tag>0</hide_tag><numerical_value/></Tag></Event></response>
